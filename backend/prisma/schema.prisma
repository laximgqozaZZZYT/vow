generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Goal {
  id        String    @id @default(cuid())
  name      String
  details   String?
  dueDate   DateTime?
  isCompleted Boolean @default(false)
  parentId  String?
  userId    String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  parent    Goal?     @relation("GoalParent", fields: [parentId], references: [id])
  children  Goal[]    @relation("GoalParent")
  user      User?     @relation(fields: [userId], references: [id])
  habits    Habit[]

  @@index([parentId], map: "Goal_parentId_fkey")
  @@index([userId], map: "Goal_userId_fkey")
}

model Habit {
  id               String    @id @default(cuid())
  goalId           String
  name             String
  active           Boolean   @default(true)
  type             String
  count            Int       @default(0)
  must             Int?
  duration         Int?
  reminders        Json?
  dueDate          DateTime?
  time             String?
  endTime          String?
  repeat           String?
  timings          Json?
  outdates         Json?
  allDay           Boolean?
  notes            String?
  workloadUnit     String?
  workloadTotal    Int?
  workloadPerCount Int?
  completed        Boolean?  @default(false)
  lastCompletedAt  DateTime?
  userId           String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  goal             Goal      @relation(fields: [goalId], references: [id])
  user             User?     @relation(fields: [userId], references: [id])

  @@index([goalId], map: "Habit_goalId_fkey")
  @@index([userId], map: "Habit_userId_fkey")
}

model Activity {
  id              String   @id @default(cuid())
  kind            String
  habitId         String
  habitName       String?
  timestamp       DateTime @default(now())
  amount          Int?
  prevCount       Int?
  newCount        Int?
  durationSeconds Int?
  userId          String?
  user            User?    @relation(fields: [userId], references: [id])

  @@index([userId], map: "Activity_userId_fkey")
}

model Preference {
  id        String   @id @default(cuid())
  key       String
  value     Json
  userId    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])

  @@unique([key, userId])
  @@index([userId], map: "Preference_userId_fkey")
}

model User {
  id         String       @id @default(cuid())
  email      String       @unique
  name       String?
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  activities Activity[]
  goals      Goal[]
  habits     Habit[]
  prefs      Preference[]
}
